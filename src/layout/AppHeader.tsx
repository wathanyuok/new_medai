"use client";
// import { ThemeToggleButton } from "@/components/common/ThemeToggleButton";
import NotificationDropdown from "@/components/header/NotificationDropdown";
import UserDropdown from "@/components/header/UserDropdown";
import { useSidebar } from "@/context/SidebarContext";
import Image from "next/image";
import Link from "next/link";
import React, { useState, useEffect, useRef } from "react";
import { usePathname } from 'next/navigation';

const AppHeader: React.FC = () => {
  const pathname = usePathname();
  const [isApplicationMenuOpen, setApplicationMenuOpen] = useState(false);

  const { isMobileOpen, toggleSidebar, toggleMobileSidebar } = useSidebar();

  const handleToggle = () => {
    if (window.innerWidth >= 1024) {
      toggleSidebar();
    } else {
      toggleMobileSidebar();
    }
  };

  const toggleApplicationMenu = () => {
    setApplicationMenuOpen(!isApplicationMenuOpen);
  };
  const inputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if ((event.metaKey || event.ctrlKey) && event.key === "k") {
        event.preventDefault();
        inputRef.current?.focus();
      }
    };

    document.addEventListener("keydown", handleKeyDown);

    return () => {
      document.removeEventListener("keydown", handleKeyDown);
    };
  }, []);

  return (
    <header className="sticky top-0 flex w-full bg-[#f2f8fd] .border-gray-200 z-99999 .dark:border-gray-800 dark:bg-gray-900 .lg:border-b">
      <div className="flex flex-col items-center justify-between grow lg:flex-row lg:px-6">
        <div className="flex items-center justify-between w-full gap-2 px-3 py-3 border-b border-gray-200 dark:border-gray-800 sm:gap-4 lg:justify-normal lg:border-b-0 lg:px-0 lg:py-4">
          <button
            className="items-center justify-center w-10 h-10 text-gray-500 border-gray-200 rounded-lg z-99999 dark:border-gray-800 lg:flex dark:text-gray-400 lg:h-11 lg:w-11 lg:border"
            onClick={handleToggle}
            aria-label="Toggle Sidebar"
          >
            {isMobileOpen ? (
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M6.21967 7.28131C5.92678 6.98841 5.92678 6.51354 6.21967 6.22065C6.51256 5.92775 6.98744 5.92775 7.28033 6.22065L11.999 10.9393L16.7176 6.22078C17.0105 5.92789 17.4854 5.92788 17.7782 6.22078C18.0711 6.51367 18.0711 6.98855 17.7782 7.28144L13.0597 12L17.7782 16.7186C18.0711 17.0115 18.0711 17.4863 17.7782 17.7792C17.4854 18.0721 17.0105 18.0721 16.7176 17.7792L11.999 13.0607L7.28033 17.7794C6.98744 18.0722 6.51256 18.0722 6.21967 17.7794C5.92678 17.4865 5.92678 17.0116 6.21967 16.7187L10.9384 12L6.21967 7.28131Z"
                  fill="currentColor"
                />
              </svg>
            ) : (
              <svg width="19" height="15" viewBox="0 0 19 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M0.562988 1.5C0.562988 1.30109 0.642006 1.11032 0.782658 0.96967C0.923311 0.829018 1.11408 0.75 1.31299 0.75H17.313C17.5119 0.75 17.7027 0.829018 17.8433 0.96967C17.984 1.11032 18.063 1.30109 18.063 1.5C18.063 1.69891 17.984 1.88968 17.8433 2.03033C17.7027 2.17098 17.5119 2.25 17.313 2.25H1.31299C1.11408 2.25 0.923311 2.17098 0.782658 2.03033C0.642006 1.88968 0.562988 1.69891 0.562988 1.5ZM0.562988 13.5C0.562988 13.3011 0.642006 13.1103 0.782658 12.9697C0.923311 12.829 1.11408 12.75 1.31299 12.75H17.313C17.5119 12.75 17.7027 12.829 17.8433 12.9697C17.984 13.1103 18.063 13.3011 18.063 13.5C18.063 13.6989 17.984 13.8897 17.8433 14.0303C17.7027 14.171 17.5119 14.25 17.313 14.25H1.31299C1.11408 14.25 0.923311 14.171 0.782658 14.0303C0.642006 13.8897 0.562988 13.6989 0.562988 13.5ZM1.31299 6.75C1.11408 6.75 0.923311 6.82902 0.782658 6.96967C0.642006 7.11032 0.562988 7.30109 0.562988 7.5C0.562988 7.69891 0.642006 7.88968 0.782658 8.03033C0.923311 8.17098 1.11408 8.25 1.31299 8.25H17.313C17.5119 8.25 17.7027 8.17098 17.8433 8.03033C17.984 7.88968 18.063 7.69891 18.063 7.5C18.063 7.30109 17.984 7.11032 17.8433 6.96967C17.7027 6.82902 17.5119 6.75 17.313 6.75H1.31299Z" fill="#465681" />
              </svg>
            )}
          </button>
          <Link href="/ai" className="lg:hidden">
            <Image
              width={154}
              height={32}
              className="dark:hidden"
              src="/images/logo/logo.svg"
              alt="Logo"
            />
            <Image
              width={154}
              height={32}
              className="hidden dark:block"
              src="/images/logo/logo.svg"
              alt="Logo"
            />
          </Link>
          {pathname == '/ai/aichat' ? (
            <button
              onClick={() => {
                window.location.reload();
              }}
              style={{ zIndex: 9999999999999 }}
              className="flex items-center justify-center w-10 h-10 text-gray-700 rounded-2xl  hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 lg:hidden "
            >
              <svg width="25" height="25" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fillRule="evenodd" clipRule="evenodd" d="M20.449 9.51739C20.7167 12.1503 19.9228 14.7811 18.2419 16.8313C16.5611 18.8814 14.131 20.1828 11.4863 20.4493C8.84157 20.7157 6.19886 19.9253 4.13951 18.252C2.08016 16.5787 0.772874 14.1595 0.505229 11.5267C0.47898 11.2799 0.552273 11.0329 0.708985 10.8399C0.865698 10.6469 1.09299 10.5238 1.34087 10.4977C1.58874 10.4716 1.83689 10.5445 2.03073 10.7006C2.22456 10.8566 2.3482 11.0828 2.37445 11.3296C2.51916 12.6935 3.00906 13.9985 3.79832 15.1226C4.58758 16.2467 5.6504 17.1531 6.88732 17.7569C8.12423 18.3607 9.49481 18.6423 10.8708 18.5753C12.2468 18.5083 13.5832 18.0948 14.755 17.3736C15.9268 16.6525 16.8956 15.6471 17.5709 14.4517C18.2461 13.2563 18.6057 11.9098 18.616 10.5384C18.6262 9.16699 18.2868 7.81539 17.6295 6.61009C16.9722 5.4048 16.0185 4.38521 14.8577 3.64673V5.80068C14.8577 6.04877 14.7587 6.28669 14.5824 6.46212C14.4062 6.63754 14.1672 6.73609 13.918 6.73609C13.6688 6.73609 13.4298 6.63754 13.2536 6.46212C13.0774 6.28669 12.9784 6.04877 12.9784 5.80068V0.5H18.3029C18.5521 0.5 18.7911 0.598552 18.9673 0.773976C19.1436 0.949401 19.2426 1.18733 19.2426 1.43541C19.2426 1.6835 19.1436 1.92143 18.9673 2.09685C18.7911 2.27228 18.5521 2.37083 18.3029 2.37083H16.3159C17.4767 3.19998 18.446 4.26659 19.1588 5.49915C19.8716 6.73171 20.3116 8.10174 20.449 9.51739ZM9.21992 2.99444C9.55219 2.99444 9.87085 2.86303 10.1058 2.62914C10.3408 2.39524 10.4727 2.078 10.4727 1.74722C10.4727 1.41644 10.3408 1.0992 10.1058 0.865302C9.87085 0.631403 9.55219 0.5 9.21992 0.5C8.88764 0.5 8.56898 0.631403 8.33403 0.865302C8.09908 1.0992 7.96709 1.41644 7.96709 1.74722C7.96709 2.078 8.09908 2.39524 8.33403 2.62914C8.56898 2.86303 8.88764 2.99444 9.21992 2.99444ZM6.40105 3.30624C6.40105 3.63703 6.26905 3.95426 6.0341 4.18816C5.79915 4.42206 5.48049 4.55346 5.14822 4.55346C4.81595 4.55346 4.49728 4.42206 4.26233 4.18816C4.02738 3.95426 3.89539 3.63703 3.89539 3.30624C3.89539 2.97546 4.02738 2.65822 4.26233 2.42433C4.49728 2.19043 4.81595 2.05902 5.14822 2.05902C5.48049 2.05902 5.79915 2.19043 6.0341 2.42433C6.26905 2.65822 6.40105 2.97546 6.40105 3.30624ZM2.32935 7.98331C2.66162 7.98331 2.98028 7.85191 3.21523 7.61801C3.45019 7.38411 3.58218 7.06688 3.58218 6.73609C3.58218 6.40531 3.45019 6.08808 3.21523 5.85418C2.98028 5.62028 2.66162 5.48888 2.32935 5.48888C1.99708 5.48888 1.67842 5.62028 1.44347 5.85418C1.20851 6.08808 1.07652 6.40531 1.07652 6.73609C1.07652 7.06688 1.20851 7.38411 1.44347 7.61801C1.67842 7.85191 1.99708 7.98331 2.32935 7.98331Z" fill="#F639BD" />
              </svg>
              {/* <span className="text-[#F639BD]">
                  เคลียร์บทสนทนา
                </span> */}
            </button>
          ) : <button className="flex items-center justify-center w-10 h-10 text-gray-700 rounded-lg z-99999 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 lg:hidden"> </button>
          }
        </div>

        <div
          className={`${isApplicationMenuOpen ? "flex" : "hidden"
            } items-center justify-between w-full gap-4 px-5 py-4 lg:flex shadow-theme-md lg:justify-end lg:px-0 lg:shadow-none`}
        >
          <div className="flex items-center gap-2 2xsm:gap-3">
            {pathname == '/aichat' ? (
              <button
                onClick={() => {
                  window.location.reload();
                }}
                className="flex items-center justify-end w-full bg-[#EFDDFD] gap-2 p-3 h-10 text-gray-700 rounded-2xl z-99999 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 "
              >
                <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fillRule="evenodd" clipRule="evenodd" d="M20.449 9.51739C20.7167 12.1503 19.9228 14.7811 18.2419 16.8313C16.5611 18.8814 14.131 20.1828 11.4863 20.4493C8.84157 20.7157 6.19886 19.9253 4.13951 18.252C2.08016 16.5787 0.772874 14.1595 0.505229 11.5267C0.47898 11.2799 0.552273 11.0329 0.708985 10.8399C0.865698 10.6469 1.09299 10.5238 1.34087 10.4977C1.58874 10.4716 1.83689 10.5445 2.03073 10.7006C2.22456 10.8566 2.3482 11.0828 2.37445 11.3296C2.51916 12.6935 3.00906 13.9985 3.79832 15.1226C4.58758 16.2467 5.6504 17.1531 6.88732 17.7569C8.12423 18.3607 9.49481 18.6423 10.8708 18.5753C12.2468 18.5083 13.5832 18.0948 14.755 17.3736C15.9268 16.6525 16.8956 15.6471 17.5709 14.4517C18.2461 13.2563 18.6057 11.9098 18.616 10.5384C18.6262 9.16699 18.2868 7.81539 17.6295 6.61009C16.9722 5.4048 16.0185 4.38521 14.8577 3.64673V5.80068C14.8577 6.04877 14.7587 6.28669 14.5824 6.46212C14.4062 6.63754 14.1672 6.73609 13.918 6.73609C13.6688 6.73609 13.4298 6.63754 13.2536 6.46212C13.0774 6.28669 12.9784 6.04877 12.9784 5.80068V0.5H18.3029C18.5521 0.5 18.7911 0.598552 18.9673 0.773976C19.1436 0.949401 19.2426 1.18733 19.2426 1.43541C19.2426 1.6835 19.1436 1.92143 18.9673 2.09685C18.7911 2.27228 18.5521 2.37083 18.3029 2.37083H16.3159C17.4767 3.19998 18.446 4.26659 19.1588 5.49915C19.8716 6.73171 20.3116 8.10174 20.449 9.51739ZM9.21992 2.99444C9.55219 2.99444 9.87085 2.86303 10.1058 2.62914C10.3408 2.39524 10.4727 2.078 10.4727 1.74722C10.4727 1.41644 10.3408 1.0992 10.1058 0.865302C9.87085 0.631403 9.55219 0.5 9.21992 0.5C8.88764 0.5 8.56898 0.631403 8.33403 0.865302C8.09908 1.0992 7.96709 1.41644 7.96709 1.74722C7.96709 2.078 8.09908 2.39524 8.33403 2.62914C8.56898 2.86303 8.88764 2.99444 9.21992 2.99444ZM6.40105 3.30624C6.40105 3.63703 6.26905 3.95426 6.0341 4.18816C5.79915 4.42206 5.48049 4.55346 5.14822 4.55346C4.81595 4.55346 4.49728 4.42206 4.26233 4.18816C4.02738 3.95426 3.89539 3.63703 3.89539 3.30624C3.89539 2.97546 4.02738 2.65822 4.26233 2.42433C4.49728 2.19043 4.81595 2.05902 5.14822 2.05902C5.48049 2.05902 5.79915 2.19043 6.0341 2.42433C6.26905 2.65822 6.40105 2.97546 6.40105 3.30624ZM2.32935 7.98331C2.66162 7.98331 2.98028 7.85191 3.21523 7.61801C3.45019 7.38411 3.58218 7.06688 3.58218 6.73609C3.58218 6.40531 3.45019 6.08808 3.21523 5.85418C2.98028 5.62028 2.66162 5.48888 2.32935 5.48888C1.99708 5.48888 1.67842 5.62028 1.44347 5.85418C1.20851 6.08808 1.07652 6.40531 1.07652 6.73609C1.07652 7.06688 1.20851 7.38411 1.44347 7.61801C1.67842 7.85191 1.99708 7.98331 2.32935 7.98331Z" fill="#F639BD" />
                </svg>
                <span className="text-[#F639BD]">
                  เคลียร์บทสนทนา
                </span>
              </button>
            ) : <button className="flex items-center justify-center w-10 h-10 text-gray-700 rounded-lg z-99999 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 lg:hidden"> </button>
            }
          </div>
          {/* <!-- User Area --> */}
          {/* <UserDropdown />  */}

        </div>
      </div>
    </header>
  );
};

export default AppHeader;
